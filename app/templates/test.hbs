<div class="container">
    <section class="row">
        <article class="col-md-12">
            <ol class="breadcrumb">
                {{#unless isGenerated}}
                    {{#link-to 'browse' tagName='li'}}{{#link-to 'browse'}}Browse{{/link-to}}{{/link-to}}
                    {{#if category.parentCategorySlug}}
                        {{#link-to 'category' category.parentCategorySlug tagName='li'}}
                            {{#link-to 'category' category.parentCategorySlug}}
                                {{category.parentCategoryName}}
                            {{/link-to}}
                        {{/link-to}}
                        {{#link-to 'subcategory' category.parentCategorySlug category.slug tagName='li'}}
                            {{#link-to 'subcategory' category.parentCategorySlug category.slug}}
                                {{category.name}}
                            {{/link-to}}
                        {{/link-to}}
                    {{else}}
                        {{#link-to 'category' category.slug tagName='li'}}
                            {{#link-to 'category' category.slug}}
                                {{category.name}}
                            {{/link-to}}
                        {{/link-to}}
                    {{/if}}
                    {{#link-to 'testInfo' slug tagName='li'}}
                        {{#link-to 'testInfo' slug}}
                            {{title}}
                        {{/link-to}}
                    {{/link-to}}
                    {{#link-to 'test' slug tagName='li'}}
                        Take test
                    {{/link-to}}
                {{/unless}}
                {{#if isProfessional}}
                    {{#link-to 'medical'}}<i class="fa fa-arrow-circle-o-left margin-right-8"></i>
                        Return to Medical Test Generator{{/link-to}}
                {{/if}}
            </ol>
        </article>
    </section>
    <section class="row">
        <article class="col-md-9 margin-bottom-16">
            <section class="row">
                <article class="col-md-12">
                    {{#unless loading}}
                        <div class="card take-test">
                            <h3>
                                {{#unless isGeneratedAttempt}}
                                    {{#link-to 'testInfo' slug}}{{title}}{{/link-to}}
                                    <small>{{#link-to 'category' category.slug}}{{category.name}}{{/link-to}}</small>
                                {{else}}
                                    {{partial 'test/srs-header'}}
                                {{/unless}}
                                {{#if currentQuestion.image}}
                                    <img class="question-image-thumbnail pull-right"
                                        {{action 'enlargeQuestionImage'}}
                                        {{bind-attr src=currentQuestion.image.secureUrl}}/>
                                {{/if}}
                            </h3>
                            <div class="row margin-bottom-16">
                                <div class="col-md-12 progress-blocks">
                                    {{#each question in shuffledQuestions itemController='test.item.progressBlock'}}
                                        <div {{bind-attr style=question.progressBlockWidth
                                        class=":progress-block question.isCurrentItem:is-current-item"}}></div>
                                    {{/each}}
                                </div>
                            </div>
                            <div class="row margin-bottom-16">
                                <div class="col-md-12">
                                    <span class="question-stem"><strong>Q{{currentQuestionNumber}}</strong> {{currentQuestion.stem}}</span>
                                </div>
                            </div>

                            {{#each option in currentQuestion.shuffledOptions}}
                                <div class="row" {{action 'optionSelected' _view.contentIndex}}>
                                    <div {{bind-attr class=":col-md-12 :option option.isSelected"}}>
                                        <span class="option-label margin-right-16">{{alphabetise-index _view.contentIndex}}</span>
                                        <span class="phrase">{{option.phrase}}</span>
                                    </div>
                                </div>
                            {{/each}}
                            <div class="row margin-top-16">
                                <div class="col-md-5">
                                    <button class="flat-button" {{action 'previousQuestion'}}>Previous</button>
                                    <button class="flat-button" {{action 'nextQuestion'}}>Next</button>
                                </div>
                                <div class="col-md-2 text-center">
                                    <p class="margin-top-16">Q{{currentQuestionNumber}} of {{questions.length}}</p>
                                </div>
                                <div class="col-md-5">
                                    <button class="flat-button pull-right"
                                        {{action 'confirmFinish'}}>Finish
                                    </button>
                                </div>
                                <div class="col-md-12 text-center">
                                    <a href="javascript:void(0)">
                                        <i class="fa fa-print" {{action 'readyToPrint'}}></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div id="printView" style="display:none;">
                            <h3>MyCQs - A social learning network</h3>
                            <h4>
                                <small>https://mycqs.com</small>
                            </h4>
                            <h4>{{title}} -
                                <small class="margin-bottom-16">{{category.name}} written by {{author.name}}</small>
                            </h4>
                            {{#each question in shuffledQuestions}}
                                <div class="row margin-bottom-16">
                                    <div class="col-md-12">
                            <span class="question-stem"><strong>Q{{math-helper _view.contentIndex '+' 1}}</strong>
                                {{question.stem}}</span>
                                    </div>
                                </div>

                                {{#each option in question.shuffledOptions}}
                                    <div class="row">
                                        <div {{bind-attr class=":col-md-12"}}>
                                            <span class="option-label margin-right-16">{{alphabetise-index _view.contentIndex}}</span>
                                            <span class="phrase">{{option.phrase}}</span>
                                        </div>
                                    </div>
                                {{/each}}
                                <hr>
                            {{/each}}
                            <p class="margin-top-16">Correct Answers</p>

                            <div style="transform: rotate(180deg);">
                                {{#each question in shuffledQuestions itemController='test/item/question'}}
                                    Q{{question.itemNumber}}-{{alphabetise-index question.correctOptionIndex}}
                                    <p class="small">{{question.feedback}}</p>
                                {{/each}}
                            </div>

                            <small>Copyright 2014 MyLabs Ltd. All rights reserved. https://mycqs.com</small>
                        </div>
                    {{else}}
                        <div class="card text-center">
                            <h3>{{loading}}</h3>
                        </div>
                    {{/unless}}
                </article>
            </section>
        </article>

        <article class="col-md-3 col-fix-right">
            <section class="row">
                {{#unless isGeneratedAttempt}}
                    {{#if isProfessional}}
                        <article class="col-md-12 col-sm-6 col-xs-12 margin-bottom-16">
                            <div class="card">
                                <h4>Generated Test</h4>
                                <p>{{#link-to 'user' author}}
                                    {{render 'profile-image' author}}{{/link-to}}
                                    {{#link-to 'user' author}}{{author.name}}{{/link-to}}</p>
                                {{#if group.name}}
                                    <h5>Group:</h5>
                                    {{#link-to 'group' group.slug}}
                                        {{group.name}}
                                    {{/link-to}}
                                {{/if}}
                            </div>
                        </article>
                    {{else}}
                        <article class="col-md-12 col-sm-6 col-xs-12 margin-bottom-16">
                            {{partial 'user/author-info'}}
                        </article>
                        <article class="col-md-12 col-sm-6 col-xs-12">
                            <div class="card">
                                <p class="text-center"><strong>Take this test from your iPhone or iPad.</strong></p>
                                <a href="https://itunes.apple.com/gb/app/mycqs-multiple-choice-questions/id921380709?mt=8"
                                   target="_blank">
                                    <img src="/img/appstore.png"
                                         style="width:100%;"/>
                                </a>
                            </div>
                        </article>
                    {{/if}}
                {{else}}
                    {{#if isProfessional}}
                        {{#unless test.id.length}}
                            <article class="col-md-12 col-sm-6 col-xs-12 margin-bottom-16">
                                <div class="card">
                                    <h4>Save this Test</h4>
                                    {{input type='text' placeholder='Give this test a title' value=testTitle
                                    class='form-control margin-bottom-8'}}
                                    {{view 'select' content=currentUser.groups optionLabelPath='content.name'
                                    prompt='Add Test to Group' class='form-control margin-bottom-8'
                                    value=selectedGroup}}
                                    {{async-button action='saveProfessionalTest' default='Save' pending='Saving...'
                                    class='btn btn-success' fulfilled='Test saved!'}}
                                </div>
                            </article>
                        {{else}}
                            <article class="col-md-12 col-sm-6 col-xs-12 margin-bottom-16">
                                <div class="card">
                                    <h4>Generated Test</h4>
                                    {{#link-to 'testInfo' test.slug}} {{test.title}} {{/link-to}}
                                    {{#if test.privacy}}<br><small> Use this link to share the test</small>{{/if}}
                                    <hr>
                                    <p>{{#link-to 'user' test.author}}
                                        {{render 'profile-image' test.author}}{{/link-to}}
                                        {{#link-to 'user' test.author}}{{test.author.name}}{{/link-to}}</p>
                                    {{#if test.group.name}}
                                        <h5>Group:</h5>
                                        {{#link-to 'group' test.group.slug}}
                                            {{test.group.name}}
                                        {{/link-to}}
                                    {{/if}}
                                </div>
                            </article>
                        {{/unless}}
                    {{/if}}
                {{/unless}}
            </section>
        </article>
    </section>
</div>