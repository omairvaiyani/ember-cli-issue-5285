<div class="container">
    <div class="card">
        <div class="cover-image" {{bind-attr style=coverImageStyle}}>
            <div class="scrim"></div>
            {{#if isEditMode}}
                {{#if temporaryChanges.coverImageURL}}
                    <div class="cover-image temporary-cover-image" {{bind-attr style=temporaryChanges.coverImageStyle}}></div>
                {{/if}}
                <div class="edit-cover-image-overlay text-center">
                    <div class="centered-block">
                        <span class='glyphicon glyphicon-camera' {{action 'toggleEditCoverImageDropdown'}}></span>

                        <p {{action 'toggleEditCoverImageDropdown'}}>Cover image</p>
                        {{#if shouldShowEditCoverImageDropdown}}
                            <div class='edit-cover-image-dropdown'>
                                <ul>
                                    <li><label for="coverImageInput">Upload photo</label></li>
                                    <input type="file" id="coverImageInput"
                                           name='coverImageInput' {{action 'uploadCoverImagePhoto' on='change'}}
                                           class="hidden-file-input"/>
                                    {{#if coverImage}}
                                        <li {{action 'removeCoverImage'}}>Remove</li>{{/if}}
                                </ul>
                            </div>
                        {{/if}}
                    </div>
                </div>
            {{/if}}
            {{#if temporaryChanges.profileImageURL}}
                {{render 'profile-image' temporaryChanges}}
            {{else}}
                {{render 'profile-image' this}}
            {{/if}}
            {{#if isEditMode}}
                <div class='edit-profile-image-overlay'>
                    <span class='glyphicon glyphicon-camera' {{action 'toggleEditProfileImageDropdown'}}></span>

                    <p {{action 'toggleEditProfileImageDropdown'}}>Profile image</p>
                    {{#if shouldShowEditProfileImageDropdown}}
                        <div class='edit-profile-image-dropdown'>
                            <ul>
                                <li><label for="profileImageInput">Upload photo</label></li>
                                <input type="file" id="profileImageInput"
                                       name='profileImageInput' {{action 'uploadProfileImagePhoto' on='change'}}
                                       class="hidden-file-input"/>
                                {{#if profilePicture}}
                                    <li {{action 'removeProfileImage'}}>Remove</li>
                                {{else}}
                                    {{#if temporaryChanges.profilePicture}}
                                        <li {{action 'removeProfileImage'}}>Remove</li>
                                    {{/if}}
                                {{/if}}
                            </ul>
                        </div>
                    {{/if}}
                </div>
            {{/if}}

            {{#if isEditMode}}
                {{input type='text' value=temporaryChanges.name class='user-name form-control'}}
            {{else}}
                <h2 class="user-name">{{#link-to 'user' this.slug}}{{name}}{{/link-to}}</h2>
            {{/if}}

            <h5>
                {{#unless isCurrentUser}}
                    {{#if isFollowing}}
                        <div class="user-following">
                            <a {{action 'unfollowUser' this}}></a>
                        </div>
                    {{else}}
                        <div class="user-follow">
                            <a {{action 'followUser' this}}>Follow</a>
                        </div>
                    {{/if}}
                {{else}}
                    <div class="user-edit">
                        {{#unless isEditMode}}
                            <a href='' {{action 'enableEditMode'}}>Edit profile</a>
                        {{else}}
                            <a href='' {{action 'cancelEditMode'}}>Cancel</a>
                            <a href='' {{action 'saveEditModeChanges'}}>Save changes</a>
                        {{/unless}}
                    </div>
                {{/unless}}
            </h5>

            <div class="user-navigation">
                {{#link-to 'user.index' tagName='button'}}Overview{{/link-to}}
                {{#link-to 'user.tests' tagName='button'}}{{numberOfTests}}
                    <small> Tests</small>{{/link-to}}
                {{#link-to 'user.following' tagName='button'}}{{numberFollowing}}
                    <small> Following</small>{{/link-to}}
                {{#link-to 'user.followers' tagName='button'}}{{numberOfFollowers}}
                    <small> Followers</small>{{/link-to}}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="card margin-top-16">
                        <!-- This will force fetch course and institution before displaying -->
                        {{#if course.name}}
                            <p><i class="fa fa-calendar-o margin-right-8"></i> Year {{yearNumber}}</p>

                            <p><i class="fa fa-book margin-right-8"></i><a {{bind-attr href=courseFacebookPageUrl}}
                                    target="_blank"
                                    >{{course.name}}</a></p>
                            <p><i class="fa fa-university margin-right-8"></i><a
                                {{bind-attr href=institutionFacebookPageUrl}}
                                    target="_blank"
                                    >{{institution.fullName}}</a></p>
                        {{else}}
                            <p>{{#if isCurrentUser}}You have not{{else}}{{firstName}} has not{{/if}} added any
                                course
                                information yet.</p>
                        {{/if}}
                        {{#if isEditMode}}
                            <p>
                                <a href=''
                                    {{action 'openModal' 'user/modal/course-selection' 'user'}}>Add or Edit course
                                    details</a>
                            </p>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>

        <div {{bind-attr class=':action-column isCurrentUser:col-md-6:col-md-9'}}>
            {{outlet}}
        </div>
        {{#if isCurrentUser}}
            <div class="col-md-3 col-fix-right">

                {{#if suggestedFollowing.length}}
                    <div class="card margin-top-16 text-center">
                        <h5>Users you may want to
                            follow</h5>
                        {{#if facebookFriendsOnMyCQs.length}}
                            <a href=''  {{action 'openModal' 'user/modal/facebook-friends' 'user'}}>
                                See all ({{facebookFriendsOnMyCQs.length}}) Facebook friends!
                            </a>
                        {{/if}}
                    </div>
                    {{#each user in suggestedFollowing itemController='user.item.user'}}
                        {{partial 'user/item/user-mini'}}
                    {{/each}}
                {{else}}
                    <div class="card margin-top-16 text-center">
                        <h5>No user suggestions right now.</h5>
                    </div>
                {{/if}}
            </div>
        {{/if}}
    </div>
</div>
<div class='margin-bottom-16'></div>